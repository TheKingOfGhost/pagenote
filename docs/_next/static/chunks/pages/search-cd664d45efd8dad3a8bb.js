(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{4952:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return A}});var n,o=i(5893),r=i(7294);!function(e){e.UN_READY="0",e.READY="1",e.STOP="-1"}(n||(n={}));var s=function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a="storage";function d(e,t){var i=JSON.stringify(t);try{window.sessionStorage.setItem(e,i)}catch(o){console.warn("\u4fe1\u606f\u8d85\u8f7d\uff0c\u53ef\u80fd\u901a\u8baf\u5931\u8d25")}var n=new Event(a);n.key=e,n.newValue=i,window.dispatchEvent(n)}function u(e){window.sessionStorage.setItem(e,"")}var c=function(){function e(e,t){this.proxy=function(){return!1},this.state=n.UN_READY,this.clientId=e,this.option=t,this.listeners={},this.startListen(),this.state=n.READY}return e.prototype.responseMessage=function(e,t,i){throw new Error("Method not implemented.")},e.prototype.startListen=function(){var e=this,t=this.option.listenKey;window.addEventListener(a,(function(i){var n;try{var o="";if(!(o=i.key===t&&i.newValue?i.newValue:sessionStorage.getItem(t)||""))return;n=JSON.parse(o)}catch(m){return}var r=n||{},a=r.header,c=r.type,l=r.data;if(a&&c&&!(a.targetClientId&&a.targetClientId!==e.clientId||a.senderClientId===e.clientId)&&(!1!==a.isResponse||!0===e.option.asServer)){var g=function(t){var i={data:t,header:s(s({},a),{isResponse:!0,originClientId:a.originClientId,targetClientId:a.senderClientId,senderClientId:e.clientId}),type:c};d(e.option.listenKey,i)},p={header:a},f=a.funId||"",h=e.listeners[f]||e.listeners[c];h?(h(l,p,g),u(t)):e.proxy&&(e.proxy(n,p,g),u(t))}}))},e.prototype.addListener=function(e,t){return this.listeners[e]=t,this},e.prototype.addProxy=function(e){this.proxy=e},e.prototype.requestMessage=function(e,t,i){var n,o=new Promise((function(e){n=e})),r=e+Date.now()+Math.random(),s=setTimeout((function(){n({success:!1,error:"timeout",data:null})}),(null===i||void 0===i?void 0:i.timeout)||this.option.timeout),a=this;this.addListener(r,(function(e){delete a.listeners[r],clearTimeout(s),n(e)}));var u=(null===i||void 0===i?void 0:i.targetClientId)||this.option.targetClientId||"",c={data:t,header:{originClientId:this.clientId,senderClientId:this.clientId,targetClientId:u,funId:(null===i||void 0===i?void 0:i.funId)||r,isResponse:!0===(null===i||void 0===i?void 0:i.isResponse),hostname:window.location.hostname},type:e};return d(this.option.listenKey,c),o},e.prototype.stopListen=function(){this.state=n.STOP},e}(),l=function(){return(l=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},g={};var p,f,h,m,v,y,I,w,C=function(){function e(e,t){if(this.listeners={},g[e])throw console.error(e,"\u5df2\u5b58\u5728\uff0c\u4e0d\u53ef\u521b\u5efa"),Error("\u8be5ID\u5df2\u5b58\u5728");g[e]=!0,this.option=t||{asServer:!0,timeout:8e3,isBackground:!0},this.clientId=e,this.state=n.UN_READY,this.proxy=function(){return!1},this.option.asServer&&this.startListen()}return e.prototype.startListen=function(){var e=this;chrome.runtime.onMessage.addListener((function(t,i,o){if(e.state!==n.READY)return!1;var r=t.data,s=t.type,a=t.header,d=void 0===a?{senderClientId:"",originClientId:"",targetClientId:"",keepConnection:!1,isResponse:!1}:a,u=d.senderClientId,c=d.originClientId,g=d.targetClientId,p=d.isResponse,f=g||e.option.targetClientId;if(f&&f!==e.clientId)return!1;var h,m,v=e.listeners[s],y=l(l({},i),{header:{originClientId:c,senderClientId:u,targetClientId:u,isResponse:p}});return v&&"function"===typeof v&&(h=v(r,y,o)),"function"===typeof e.proxy&&(h=e.proxy(t,y,o)),h="object"===typeof(m=h)&&null!==m&&"then"in m&&"catch"in m||!1!==h,d.keepConnection||h})),this.state=n.READY},e.prototype.stopListen=function(){this.state=n.STOP},e.prototype.addListener=function(e,t){return this.listeners[e]=t,this},e.prototype.addProxy=function(e){this.proxy=e},e.prototype.requestMessage=function(e,t,i){var n,o={type:e,data:t,header:{targetClientId:(null===i||void 0===i?void 0:i.targetClientId)||this.option.targetClientId||"",originClientId:(null===i||void 0===i?void 0:i.originClientId)||this.clientId,senderClientId:this.clientId,isResponse:!1,keepConnection:null===i||void 0===i?void 0:i.keepConnection}},r=new Promise((function(e,t){n=e})),s=setTimeout((function(){n({success:!1,error:{reason:"timeout",request:o},data:null}),console.warn("timeout",o)}),(null===i||void 0===i?void 0:i.timeout)||this.option.timeout),a=function(e){clearTimeout(s),n(e)};if(this.option.isBackground){var d=null===i||void 0===i?void 0:i.targetTabId;d?chrome.tabs.sendMessage(d,o,a):chrome.tabs.query({active:!0,currentWindow:!0},(function(e){var t,i=null===(t=e[0])||void 0===t?void 0:t.id;if(!i)throw Error("\u672a\u627e\u5230\u5f53\u524d\u6fc0\u6d3btab\u9875");chrome.tabs.sendMessage(i,o,a)}))}else chrome&&chrome.runtime?chrome.runtime.sendMessage(o,a):a({success:!1,error:"\u63d2\u4ef6\u4e0d\u53ef\u7528",data:null});return r},e.prototype.responseMessage=function(e,t,i){console.error("extension \u65e0\u9700\u5b9e\u73b0")},e}();!function(e){e.id="boxroom"}(p||(p={})),function(e){e.id="lightpage"}(f||(f={})),function(e){e.id="setting"}(h||(h={})),function(e){e.id="browserAction",function(e){e.enable="images/light-32.png",e.disable="images/light-disable.png"}(e.ActionImageType||(e.ActionImageType={}))}(m||(m={})),function(e){e.id="action"}(v||(v={})),function(e){e.id="user"}(y||(y={})),function(e){e.id="localdir"}(I||(I={})),function(e){e.id="front-server"}(w||(w={}));var P,b=function(){return Promise.resolve({success:!1,error:"not allowed",data:void 0})},S=function(e){return{lightpage:{exportPages:e("exportPages",f.id),importPages:e("importPages",f.id),removeLightPages:e("removeLightPages",f.id),getLightPageDetail:e("getLightPageDetail",f.id),getLightPages:e("getLightPages",f.id),groupPages:e("groupPages",f.id),removeLightPage:e("removeLightPage",f.id),saveLightPage:e("saveLightPage",f.id)},boxroom:{update:e("update",h.id),get:e("get",h.id),remove:e("remove",h.id),save:e("save",h.id)},setting:{getSetting:e("getSetting",h.id),getUserSetting:e("getUserSetting",h.id),resetSetting:e("resetSetting",h.id),saveSetting:e("saveSetting",h.id),syncSetting:e("syncSetting",h.id)},browserAction:{setBrowserActionClick:b,setBrowserActionDisplay:e("setBrowserActionDisplay",v.id),getBrowserActionInfo:e("getBrowserActionInfo",v.id)},commonAction:{report:e("report",v.id),getMemoryRuntime:e("getMemoryRuntime",v.id),setMemoryRuntime:e("setMemoryRuntime",v.id),usage:e("usage",v.id),injectToFrontPage:e("injectToFrontPage",v.id),copyToClipboard:e("copyToClipboard",v.id),captureView:e("captureView",v.id),axios:e("axios",v.id),injectCodeToPage:e("injectCodeToPage",v.id),track:e("track",v.id)},fileSystem:{readPagesFrontDir:e("readPagesFrontDir",I.id),requestPermission:e("requestPermission",I.id)}}},x=S((function(e,t){return function(t){if(!P){var i="page_bridge";P=chrome&&chrome.runtime?new C(i,{asServer:!0,isBackground:!1,timeout:5e3}):new c(i,{asServer:!0,listenKey:"pagenote-message",timeout:8e3})}return P.requestMessage(e,t)}})),k=i(1163);function A(){var e=(0,k.useRouter)().query.keywords,t=void 0===e?"pagenote":e,i=(0,r.useState)([]),n=i[0],s=i[1],a=(0,r.useState)((function(){return{pages:0,limit:10,total:0}})),d=a[0],u=a[1],c=(0,r.useState)(0),l=c[0],g=c[1];return(0,r.useEffect)((function(){!function(){var e={deleted:!1,$or:[{text:{$like:t}},{domain:{$like:t}},{tip:{$like:t}},{context:{$like:t}},{categories:{$like:t}}]};console.time("sousuo"),x.lightpage.getLightPages({limit:d.limit,skip:l*d.limit,query:e}).then((function(e){console.log("\u62c9\u53d6\u7ed3\u679c",e),console.timeEnd("sousuo"),e.success&&(s(e.data.pages),u(e.data.pagination))}))}()}),[l,t]),(0,r.useEffect)((function(){x.setting.getUserSetting().then((function(e){})),x.commonAction.usage().then((function(e){console.log(e)})),x.browserAction.getBrowserActionInfo({tabId:void 0}).then((function(e){})),setTimeout((function(){x.browserAction.setBrowserActionDisplay({info:{text:"hi",color:"#9affe9",title:"\u548c\u6765\u6765\u6765"},tabId:void 0}).then((function(e){}))}),1e3)}),[]),(0,o.jsxs)("div",{className:"container w-1/2 sm:w-full m-auto my-8",children:[n.map((function(e,t){return(0,o.jsxs)("div",{className:"text-base",children:[t,": ",e.plainData.title||e.plainData.url]},e.key)})),(0,o.jsxs)("div",{children:["\u641c\u7d22\u7ed3\u679c\u5171\u6709\uff1a",d.total," \u4e2a",new Array(d.pages).fill(1).map((function(e,t){return(0,o.jsx)("button",{onClick:function(){g(t)},children:t},t)}))]})]})}},881:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/search",function(){return i(4952)}])},1163:function(e,t,i){e.exports=i(4651)}},function(e){e.O(0,[774,888,179],(function(){return t=881,e(e.s=t);var t}));var t=e.O();_N_E=t}]);